<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>RCRacePerformance</title>
	<link rel="stylesheet" type="text/css" href="static/default.css"/>

	<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
	<!--
	<script type="text/javascript" src="/flot/jquery.js"></script>
	-->
	<script type="text/javascript" src="/flot/jquery.flot.js"></script>
		
 	<script src="static/jquery.dataTables.js" type="text/javascript" language="javascript"></script>
 	
	<script type="text/javascript">
		// Graph of the racers history and results over time.
		$(function (data) {
		var css_id = "#placeholder";
		var data = {% autoescape off %} {{ jsdata }} {% endautoescape %};    
		var options = {
			yaxis: {
		    	ticks: 10,
		        min: 0,
		        max: 10
		    },
		    xaxis: { mode: "time" }, 
		    series: {color: '#0055bb',
		    	stack: 0,
		        lines: {show: false, steps: false },
		        bars: {show: true, barWidth: 0.9, align: 'center',},
		    },                
		};
		
		$.plot($(css_id), data, options);
		});
    </script>		
	    
	<!-- Script for the tabs -->
	<script type="text/javascript"  charset="utf-8">
		{% if recent_race_data %}			    
			{% for track in recent_race_data %}			
			  	$(document).ready(function() {
				    $("#tracktabs_{{ track.js_id }}").tabs();
			  	});			  	
	  		{% endfor %}
	  	{% else %}
	  		// Warning - no race data for recent races.	  	
	  	{% endif %}	  	  	
  	
  	<!-- Script for the buttons -->
  	$(document).ready(function() {
  	var ajax_load = "<img class='loading' src='images/loadingGif.gif' alt='loading...' />";
		
  	{% for track in recent_race_data %}
  	{% for class in track.classes %}
  	{% for race in class.individual_racedata %}
		$("#load_basic_{{ track.js_id }}_{{ class.js_id }}_{{ race.js_id }}").click(function(){
			$("#result_{{ track.js_id }}_{{ class.js_id }}").html(ajax_load).load("/rcdata/displayresults/{{ race.id }}/"); 
			$("#lap_graph_{{ track.js_id }}_{{ class.js_id }}").html(ajax_load).load("/rcdata/displayresults/singleracerlaps/{{ race.id }}/{{ racerid }}/");
		});		
	{% endfor %}
	// Display the first results returned.
	$("#result_{{ track.js_id }}_{{ class.js_id }}").html(ajax_load).load("/rcdata/displayresults/{{ class.individual_racedata.0.id }}/"); 
	$("#lap_graph_{{ track.js_id }}_{{ class.js_id }}").html(ajax_load).load("/rcdata/displayresults/singleracerlaps/{{ class.individual_racedata.0.id }}/{{ racerid }}/"); 
	
	{% endfor %}
	{% endfor %}
	
	});
  	</script>
	
</head>

<body>

    <div class="wrapOverall">
    
        <div class="header">
        	
        	<a href="/rcdata">
          	<img class="logo" src="images/headerLogo.png" width="564" height="52" alt="RCRacePerformance"/>
          	</a>
          
        	<div class="navMain">
            	
                <ul>                    
					<li><a href="/rcdata/myresults">MyResults</a></li>
                    <li><a href="/rcdata/trackdata">TrackData</a></li>
                </ul>
                
            </div>
        		
        </div> <!-- END header -->
		
		<h3>General race statistics for {{ racername }}</h3>
		
		<div>
			<h4>The total number of main events organized by race class.</h4>
			<p>This is filtered by races that marked as 'main' events.</p>
			
			{% if class_frequency %}
			    <ul>
			    {% for class in class_frequency %}
			        <li>{{ class.0 }} {{ class.1 }}</li>		        
			    {% endfor %}
			    </ul>
			{% else %}
			    <p>No main event race information available.</p>
			{% endif %}	
		</div>
		
		<!-- Overview of the js object from the view we are going to work with:
		    [
		        {
		         "js_id": <>
		         "trackname": <>,
		         "classes": [
		                    {"js_id":<>
		                     "classname": <>,
		                     "individual_racedata": [
		                                             {'date':<>, 'id':<>, "js_id":<>}, 
		                                             ...
		                                            ]
		                    }
		                    ... Multiple classes
		                   ]
		         }
		         ... Multiple tracks 
		    ]
		
		-->
		
		{% if recent_race_data %}
			    
			
			{% for track in recent_race_data %}
			<!-- ************************************************* -->
			<!-- Track Section -->
			<!-- ************************************************* -->
			<h4>{{ track.trackname }}</h4>
		    
		    <div id="tracktabs_{{ track.js_id }}"> <! -- Recent race history -->
			    <ul>			    
			    	{% for class in track.classes %}
					<!-- ************************************************* -->
					<!-- Class Tabs Section -->
					<!-- ************************************************* -->
		        	<li><a href="#classtabs_{{ track.js_id }}_{{ class.js_id }}">
		        		<span>{{ class.classname }}</span>
		        	</a></li>
			        {% endfor %}
			        
			    </ul>
			    
			    {% for class in track.classes %}				    	
				<!-- ************************************************* -->
				<!-- Class Tab CONTENT Section -->
				<!-- ************************************************* -->
		    	<div id="classtabs_{{ track.js_id }}_{{ class.js_id }}">		    	
		    		<p>{{ class.classname }} General race statistics that can be filtered by time.</p>
					<!-- ************************************************* -->
					<!-- Race Date BUTTON Section -->
					<!-- ************************************************* -->		    		
		    		{% for race in class.individual_racedata %}
					<input type="submit" value="{{ race.date }}" id="load_basic_{{ track.js_id }}_{{ class.js_id }}_{{ race.js_id }}" />     
					{% endfor %}					
					<div id="result_{{ track.js_id }}_{{ class.js_id }}"  class="functions"></div> 
					<div id="lap_graph_{{ track.js_id }}_{{ class.js_id }}"  class="functions" style="width:950px;height:500px;"></div> 
					
	    		</div>
	    		
		    	{% endfor %}
			</div> <!-- END tabs -->  	    
			{% endfor %}
			    
		{% else %}
			    <p>No recent race history available.</p>
		{% endif %}	
		
		<div>
		
			<h4>Total race history organized by the date of the race.</h4>
		
			<p>
			Race results graphed by time (shorter bars are better). The 
			x-axis uses time as a scale, so you can	see periods of 
			inactivity or more frequent racing. The y-axis (height of 
			the bar) indicates how you finished the race, 1 being first
			place.
			</p>  
					
			<div id="placeholder" style="width:950px;height:300px;"></div>

		</div>	
		
	</div>
</body>
</html>