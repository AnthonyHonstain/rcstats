'''
Created on May 2013

@author: Anthony Honstain
'''

from rcstats.rcdata.models import LapTimes
from rcstats.rcdata.models import SingleRaceDetails
from rcstats.rcdata.models import SingleRaceResults
from rcstats.rcdata.models import RacerId

import rcstats.uploadresults.models as models
from rcstats.uploadresults.tests.general_race_uploader import GeneralRaceUploader


class BadRaceFilesTest(GeneralRaceUploader):

    singlerace_testfile1 = '''Scoring Software by www.RCScoringPro.com                3:09:41 PM  08/18/2012

                            

SC Pro 4 A Main                                               Round# 3, Race# 7

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
Whetsell, Keith            #5         18         6:05.034         20.690                  
Anton, Mark            #2         18         6:10.838         20.612             5.804
Seim, Roger            #1         17         6:01.006         21.200                  
Sturgell, Dennis            #4         17         6:17.843         20.609            16.837
Botti, Matt            #6         16         6:09.601         21.711                  
Meyer, Jim            #7         16         6:09.805         22.492             0.204
Brown, Shaun            #10        16         6:10.315         22.140             0.714
Andres, Jonathan            #11        16         6:18.721         22.472             9.120
Aldous, Steve            #9         16         6:19.856         22.813            10.255
Casey, Joe            #8         15         6:01.177         22.037                  
Huddleston, Chris            #3          3           51.832         23.550                  

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 3/3.587 1/2.487 5/4.240 4/3.792 2/2.899 9/6.557 6/4.734 11/6.85 8/6.290 7/6.126
101/02.5145/01.0 85/00.4 95/00.0125/02.5 55/00.7 77/04.2 53/03.5 58/04.8 59/01.6

 3/21.98 1/21.70 5/24.04 4/22.16 2/21.89 10/30.3 6/23.76 11/31.3 7/24.11 9/28.92
 29/10.7 30/02.8 26/07.6 28/03.4 30/11.8 20/08.6 26/10.5 19/03.1 24/04.9 21/08.0

 2/21.77 3/23.56 5/23.55 4/24.55 1/20.85 9/23.65 6/24.72 10/22.7 7/23.29 11/26.9
 23/03.0 23/06.0 21/02.8 22/10.4 24/05.1 18/03.0 21/12.6 18/06.0 21/15.9 18/11.8

 2/21.61 3/21.35         4/21.67 1/20.79 10/27.1 7/28.14 9/25.03 5/25.76 8/23.82
 21/02.0 21/02.8         20/00.9 22/05.3 17/12.6 18/06.1 17/05.6 19/17.4 17/04.6

 2/22.67 3/22.93         4/24.59 1/20.75 10/21.9 6/23.85 9/22.63 5/22.81 8/22.71
 20/06.5 20/08.1         19/07.7 21/06.1 17/12.7 18/18.8 17/09.4 18/08.2 17/08.9

 2/21.21 3/21.98         4/23.23 1/20.95 6/22.07 7/27.35 8/25.24 5/22.81 10/28.9
 20/16.1 19/01.0         18/00.0 20/00.4 17/13.1 17/15.6 17/19.4 18/15.2 16/06.5

 3/23.74 2/21.25         4/21.12 1/20.71 6/22.91 7/22.70 8/22.03 5/25.44 9/22.36
 19/10.7 19/07.2         18/02.9 20/08.1 17/15.5 17/17.1 17/18.7 17/05.5 16/05.2

 2/22.48 1/21.18         3/21.72 4/41.92 5/22.65 6/23.90 7/24.53 8/31.10 9/22.64
 19/17.8 19/11.6         18/06.4 17/02.8 17/16.7 17/20.7 16/00.9 16/03.3 16/04.8

 2/21.20 1/22.06         3/20.60 4/21.27 5/21.71 6/23.73 8/25.53 9/24.70 7/22.26
 18/00.5 19/16.9         18/06.9 17/02.7 17/15.8 16/00.7 16/06.2 16/06.8 16/03.9

 2/22.23 1/20.95         3/21.85 4/20.77 5/23.92 6/22.51 8/23.24 10/27.1 7/22.74
 18/04.5 19/19.0         18/09.6 17/01.7 17/18.9 16/00.7 16/06.8 16/13.6 16/03.9

 3/25.40 1/23.89         2/22.30 4/22.14 6/26.65 5/22.49 9/27.91 10/25.8 7/27.38
 18/12.9 18/05.5         18/12.5 17/03.1 16/03.0 16/00.6 16/14.0 16/17.1 16/10.6

 2/22.55 1/21.14         3/27.18 4/22.96 6/23.70 5/22.58 9/24.27 10/23.2 7/22.57
 18/15.7 18/06.8         17/01.0 17/05.4 16/04.3 16/00.6 16/15.2 16/16.7 16/09.8

 2/21.24 1/20.86         4/28.33 3/20.69 6/22.84 5/22.56 9/24.75 10/27.3 7/23.31
 18/16.2 18/07.4         17/10.2 17/04.3 16/04.4 16/00.7 16/16.8 16/21.4 16/10.1

 2/21.81 1/20.97         4/21.27 3/21.02 5/23.04 6/29.20 8/23.72 10/23.1 7/24.46
 18/17.4 18/08.2         17/09.6 17/03.8 16/04.7 16/08.3 16/17.0 16/20.6 16/11.6

 2/22.08 1/21.21         4/26.96 3/23.39 5/26.64 6/24.07 10/31.2 9/22.88 7/22.14
 18/18.7 18/09.1         17/15.5 17/06.1 16/08.8 16/09.4 15/01.1 16/19.6 16/10.4

 2/21.40 1/21.70         4/22.41 3/21.02 5/23.78 6/23.43         9/23.91 7/22.99
 18/19.1 18/10.4         17/15.9 17/05.5 16/09.6 16/09.8         16/19.8 16/10.3

 2/23.97 1/20.92         4/24.03 3/20.97                                        
 17/01.0 18/10.8         17/17.8 17/05.0                                        

         1/20.61                                                                
         18/10.8                                                                
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
     17/     18/      3/     17/     18/     16/     16/     15/     16/     16/
  6:01.0  6:10.8    51.8  6:17.8  6:05.0  6:09.6  6:09.8  6:01.1  6:19.8  6:10.3                                
 '''

    doublerace_testfile2 = '''Scoring Software by www.RCScoringPro.com                9:26:42 PM  7/17/2012

                   TACOMA R/C RACEWAY

MODIFIED BUGGY A Main                                         Round# 3, Race# 2

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
Alpha, Jon            #2         28         8:18.588         17.042                  
Beta, Jon            #4         27         8:08.928         17.116                  
Charlie, Jon            #5         26         8:00.995         17.274                  
Delta, Jon            #3         25         8:02.680         17.714                  
Echo, Jon            #1          1           35.952         35.952                  

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 5/35.95 1/26.24 4/30.95 2/27.01 3/29.63                                        
         1/17.47 4/18.67 2/19.47 3/17.76                                        
         1/17.33 4/17.71 2/17.83 3/17.55                                        
         1/17.27 4/19.73 2/17.85 3/17.92                                        
         1/17.08 4/19.64 2/18.29 3/17.88                                        
         1/17.07 4/18.33 2/17.92 3/17.82                                        
         1/17.66 4/17.83 2/17.66 3/17.89                                        
         1/17.39 4/17.82 2/17.37 3/17.67                                        
         1/17.54 4/18.88 2/17.79 3/17.75                                        
         1/17.04 4/18.62 2/17.41 3/17.67                                        
         1/17.30 4/17.72 2/17.52 3/18.81                                        
         1/19.07 4/20.62 2/17.82 3/18.23                                        
         1/17.30 4/20.27 2/17.46 3/17.35                                        
         1/17.05 4/18.85 2/17.63 3/18.45                                        
         1/17.10 4/19.43 2/17.59 3/17.61                                        
         1/17.46 4/18.10 2/17.96 3/18.86                                        
         1/17.17 4/17.82 2/17.68 3/17.67                                        
         1/17.28 4/17.86 2/17.96 3/17.27                                        
         1/17.05 4/17.89 2/17.43 3/17.47                                        
         1/17.16 4/18.43 2/17.34 3/17.60                                        
         1/17.39 4/23.66 2/18.26 3/17.73                                        
         1/17.44 4/18.52 2/17.51 3/18.30                                        
         1/17.28 4/19.18 2/18.22 3/21.11                                        
         1/17.39 4/18.03 2/17.65 3/17.46                                        
         1/17.48 4/18.05 2/17.83 3/17.74                                        
         1/17.14         2/17.25 3/19.69                                        
         1/17.61         2/17.11                                                
         1/20.71                                                                
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
      1/     28/     25/     27/     26/                                        
    35.9  8:18.5  8:02.6  8:08.9  8:00.9    

    
Scoring Software by www.RCScoringPro.com                9:21:34 PM  08/07/2012

                     Shouldn't Be Different

MODIFIED BUGGY A Main                                            Round# 3, Race# 1

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
Beta, Jon            #3         19         6:07.101         18.455                  
Charlie, Jon            #1         19         6:14.602         18.466             7.501
Alpha, Jon            #5         18         6:05.124         18.480                  
Delta, Jon            #2         18         6:11.982         18.716             6.858
Echo, Jon            #4         17         6:02.475         18.941                  
Hotel, Jon            #6         17         6:03.349         19.537             0.874
Golf, Jon            #7         17         6:16.439         18.222            13.964

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 3/28.74 2/27.53 1/26.13 6/30.70 5/30.42 7/32.44 4/29.80                        
 2/19.57 3/21.31 1/19.29 6/21.40 4/18.91 7/20.33 5/20.96                        
 2/18.47 3/18.71 1/19.10 7/21.29 4/18.70 6/20.31 5/18.22                        
 2/19.54 3/19.13 1/18.69 7/20.05 4/19.36 6/19.76 5/21.53                        
 2/18.56 3/19.42 1/18.72 5/19.17 4/19.13 7/21.82 6/22.97                        
 2/18.85 4/19.59 1/18.82 5/18.97 3/18.87 7/20.40 6/18.49                        
 2/18.46 3/19.18 1/18.67 5/19.18 4/19.75 7/21.11 6/23.58                        
 2/18.74 4/21.79 1/19.12 5/20.44 3/18.48 7/22.42 6/20.81                        
 2/18.66 4/20.58 1/18.90 5/20.83 3/21.26 6/19.61 7/28.41                        
 2/20.27 4/18.76 1/19.66 5/19.30 3/18.61 6/19.87 7/21.39                        
 2/18.99 3/18.84 1/18.58 5/23.29 4/21.56 6/20.51 7/19.01                        
 2/18.66 4/21.48 1/18.45 5/19.00 3/19.81 6/19.53 7/19.41                        
 2/18.80 4/19.23 1/18.72 5/19.46 3/19.21 6/19.71 7/18.99                        
 2/19.54 4/19.16 1/19.38 5/18.99 3/18.89 6/20.04 7/23.71                        
 2/19.18 4/24.52 1/18.77 5/18.94 3/19.24 6/20.66 7/24.06                        
 2/19.03 4/20.51 1/18.99 6/31.83 3/18.74 5/23.91 7/19.68                        
 2/21.82 6/42.18 1/19.27 4/19.56 3/21.18 5/20.83 7/25.33                        
 2/19.48         1/18.89         3/22.91                                        
 2/19.17         1/18.86                                                        
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
     19/     18/     19/     17/     18/     17/     17/                        
  6:14.6  6:11.9  6:07.1  6:02.4  6:05.1  6:03.3  6:16.4   
'''

    singlerace_testfile3 = '''Scoring Software by www.RCScoringPro.com                3:09:41 PM  08/18/2012
                                
 '''

    singlerace_testfile4 = ''' '''

    singlerace_testfile5 = '''Scoring Software by www.RCScoringPro.com                7:09:52 PM  04/08/2013

                     TACOMA RC RACEWAY TUESDAY NIGHT RACING

STOCK BUGGY                                                   Round# 1, Race# 1

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
SHIRK, MIKE            #6         21         6:14.594         16.940                  
JUSTIN GILKISON            #7         20         6:06.675         17.252                  
AUTRY, BRIAN            #5         20         6:11.090         17.058             4.415
MIKE MOLOSEAU            #3         19         6:12.442         17.760                  
MOREHEAD, PATRICK            #4         18         6:07.798         17.560                  
HENDERSON, JEFF            #2         18         6:13.828         18.209             6.030
SCOVRONSKI, JEREMY            #1         17         6:00.082         18.588                  

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 6/32.51 5/30.02 4/28.86 7/32.67 2/27.82 1/26.50 3/28.09                        
 7/19.80 5/18.86 4/18.61 6/18.58 2/17.18 1/17.37 3/17.63                        
 7/19.72 4/19.82 6/23.32 5/17.90 2/18.96 1/17.44 3/18.83                        
 6/20.15 4/19.57 5/18.47 7/23.61 2/17.41 1/17.48 3/17.25                        
 7/19.90 4/18.89 5/18.27 6/18.60 2/17.61 1/17.53 3/18.07                        
 7/19.70 4/19.06 5/19.01 6/18.78 2/18.43 1/17.23 3/18.07                        
 6/19.24 5/23.02 4/19.60 7/26.32 2/17.47 1/17.47 3/17.46                        
 6/20.05 5/18.60 4/18.43 7/17.56 2/17.70 1/17.64 3/18.10                        
 6/20.00 5/18.47 4/18.24 7/18.10 3/22.92 1/17.86 2/17.96                        
 5/19.61 6/24.42 4/17.76 7/22.41 3/17.51 1/17.66 2/17.59                        
 7/24.05 6/23.03 4/18.61 5/18.58 3/17.29 1/16.95 2/17.93                        
 5/21.13 6/23.73 4/20.11 7/24.77 3/17.70 1/17.24 2/17.99                        
 6/20.36 7/23.29 4/18.37 5/18.22 3/17.05 1/17.66 2/17.39                        
 6/21.89 7/18.47 4/18.12 5/17.91 3/17.54 1/17.98 2/18.20                        
 7/21.63 6/18.63 4/17.88 5/17.94 3/17.86 1/17.58 2/17.52                        
 7/21.70 6/18.96 4/23.34 5/19.47 3/17.48 1/16.94 2/17.52                        
 7/18.58 6/18.70 4/18.60 5/17.91 3/17.66 1/17.56 2/17.65                        
         6/18.20 4/18.28 5/18.39 3/17.28 1/17.06 2/17.76                        
                 4/18.52         3/18.34 1/17.08 2/17.46                        
                                 3/19.80 1/17.01 2/18.10                        
                                         1/17.24                                
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
     17/     18/     19/     18/     20/     21/     20/                        
  6:00.0  6:13.8  6:12.4  6:07.7  6:11.0  6:14.5  6:06.6 
'''

    singlerace_testfile6 = '''Scoring Software by www.RCScoringPro.com                7:09:52 PM  04/08/2013

                     TACOMA RC RACEWAY TUESDAY NIGHT RACING

STOCK BUGGY                                                   Round# 1, Race# 1

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
SHIRK, MIKE            #6         21         6:14.594         16.940                  
JUSTIN GILKISON            #7         20         6:06.675         17.252                  
AUTRY, BRIAN            #5         20         6:11.090         17.058             4.415
MIKE MOLOSEAU            #3         19         6:12.442         17.760                  
MOREHEAD, PATRICK            #4         18         6:07.798         17.560                  
HENDERSON, JEFF            #2         18         6:13.828         18.209             6.030
SCOVRONSKI, JEREMY            #1         17         6:00.082         18.588                  

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 6/32.51 5/30.02 4/28.86 7/32.67 2/27.82 1/26.50 3/28.09                        
 7/19.80 5/18.86 4/18.61 6/18.58 2/17.18 1/17.37 3/17.63                        
 7/19.72 4/19.82 6/23.32 5/17.90 2/18.96 1/17.44 3/18.83                        
 6/20.15 4/19.57 5/18.47 7/23.61 2/17.41 1/17.48 3/17.25                        
 7/19.90 4/18.89 5/18.27 6/18.60 2/17.61 1/17.53 3/18.07                        
 7/19.70 4/19.06 5/19.01 6/18.78 2/18.43 1/17.23 3/18.07                        
 6/19.24 5/23.02 4/19.60 7/26.32 2/17.47 1/17.47 3/17.46                        
 6/20.05 5/18.60 4/18.43 7/17.56 2/17.70 1/17.64 3/18.10                        
 6/20.00 5/18.47 4/18.24 7/18.10 3/22.92 1/17.86 2/17.96                        
 5/19.61 6/24.42 4/17.76 7/22.41 3/17.51 1/17.66 2/17.59                        
 7/24.05 6/23.03 4/18.61 5/18.58 3/17.29 1/16.95 2/17.93                        
 5/21.13 6/23.73 4/20.11 7/24.77 3/17.70 1/17.24 2/17.99                        
 6/20.36 7/23.29 4/18.37 5/18.22 3/17.05 1/17.66 2/17.39                        
 6/21.89 7/18.47 4/18.12 5/17.91 3/17.54 1/17.98 2/18.20                        
 7/21.63 6/18.63 4/17.88 5/17.94 3/17.86 1/17.58 2/17.52                        
 7/21.70 6/18.96 4/23.34 5/19.47 3/17.48 1/16.94 2/17.52                        
 7/18.58 6/18.70 4/18.60 5/17.91 3/17.66 1/17.56 2/17.65                        
         6/18.20 4/18.28 5/18.39 3/17.28 1/17.06 2/17.76                        
                 4/18.52         3/18.34 1/17.08 2/17.46                        
                                 3/19.80 1/17.01 2/18.10                        
                                         1/17.24                                
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
     17/     18/     19/     18/     20/     21/     20/                        
  6:00.0  6:13.8  6:12.4  6:07.7  6:11.0  6:14.5  6:06.6 
'''
    
    # NOTE - this is a problem result because there are more racers in the header than
    # there are in the actual laps.
    singlerace_testfile7 = '''Scoring Software by www.RCScoringPro.com                3:30:20 PM  04/27/2013

                  TACOMA RC RACEWAY PRESENTS SHOWDOWN ROUND 7

DASH FOR CASH MOD BUGGY                                       Round# 4, Race# 2

________________________Driver___Car#____Laps____RaceTime____Fast Lap___Behind_
TRAN, THOMAS            #4         14         4:10.838         16.768                  
WALENTIA, JOHN            #6         14         4:13.880         14.221             3.042
DUNLAP, SHAUN            #9         13         4:00.407         16.444                  
COURTWAY, ZANE            #3         13         4:04.235         16.737             3.828
RYAN MATESA            #2         13         4:04.446         16.386             4.039
BROWN, MIKE            #5         13         4:05.240         16.218             4.833
Barnes, Marty            #7         13         4:06.547         16.587             6.140
LEIGHAN, JACK            #10        13         4:12.449         16.985            12.042
GOULD, CHRIS            #1          2           43.375         16.495                  
RYAN MATESA            #11         0            0.000          0.000                  

 ___1___ ___2___ ___3___ ___4___ ___5___ ___6___ ___7___ ___8___ ___9___ ___10__
 2/26.88 5/28.62 7/30.70 1/26.14 6/30.30 4/28.23 9/32.00         3/27.48 8/31.07
 1/16.49 5/16.94 7/17.16 2/17.77 6/16.73 4/16.43 8/16.91         3/16.69 9/18.52
         4/16.98 8/20.76 1/16.93 5/18.88 3/17.17 6/17.51         2/17.12 7/17.59
         4/16.55 8/19.46 1/16.76 5/16.21 3/16.98 6/16.58         2/17.17 7/16.98
         5/21.41 7/17.33 1/17.09 3/16.91 6/23.53 4/17.02         2/17.35 8/24.44
         4/16.90 7/17.23 1/17.37 5/19.11 6/17.05 3/16.92         2/20.10 8/17.74
         6/20.55 7/17.38 1/16.76 4/16.96 5/17.20 3/17.85         2/18.02 8/17.27
         6/16.74 7/17.18 1/17.13 2/16.49 4/16.68 3/18.00         5/19.83 8/17.63
         6/16.38 7/16.89 1/17.62 2/16.78 4/16.60 3/16.77         5/16.76 8/17.35
         6/17.85 7/16.73 1/17.14 5/20.30 4/18.47 2/17.05         3/17.43 8/17.05
         5/17.54 6/16.85 1/17.27 7/20.84 4/17.25 2/17.36         3/16.44 8/21.65
         4/17.11 6/17.55 1/17.50 7/16.85 2/17.23 5/20.73         3/18.73 8/17.76
         5/20.83 4/18.95 1/17.61 6/18.81 2/16.78 7/21.78         3/17.21 8/17.34
                         1/17.68         2/14.22                                
 ------- ------- ------- ------- ------- ------- ------- ------- ------- -------
      2/     13/     13/     14/     13/     14/     13/             13/     13/
    43.3  4:04.4  4:04.2  4:10.8  4:05.2  4:13.8  4:06.5          4:00.4  4:12.4



Top Qualifiers for DASH FOR CASH MOD BUGGY              04/27/2013 3:30:21 PM

Qual#  Name                          Laps  Race Time  Rnd  Pos  Behind FastLap
-----  ----------------------------  ----  ---------  ---  ---  ------ -------
  1.   TRAN, THOMAS                   14    4:10.838   4    1    
  2.   WALENTIA, JOHN                 14    4:13.880   4    2    3.042
  3.   DUNLAP, SHAUN                  13    4:00.407   4    3    
  4.   COURTWAY, ZANE                 13    4:04.235   4    4    3.828
  5.   RYAN MATESA                    13    4:04.446   4    5    4.039
  6.   BROWN, MIKE                    13    4:05.240   4    6    4.833
  7.   Barnes, Marty                  13    4:06.547   4    7    6.140
  8.   LEIGHAN, JACK                  13    4:12.449   4    8    12.042
  9.   GOULD, CHRIS                    2      43.375   4    9    
  9.   RYAN MATESA                     0         DNS   4   10    


'''

    racelist_to_upload = [{'filename':'upload1', 'filecontent':singlerace_testfile1},
                          {'filename':'upload2', 'filecontent':doublerace_testfile2},
                          {'filename':'upload3', 'filecontent':singlerace_testfile3},
                          {'filename':'upload4', 'filecontent':singlerace_testfile4},
                          {'filename':'upload5', 'filecontent':singlerace_testfile5},
                          {'filename':'upload6', 'filecontent':singlerace_testfile6},
                          {'filename':'upload7', 'filecontent':singlerace_testfile7},]
    

    def test_multipleraces_upload(self):
        #====================================================
        # Validate that an error was recorded in the db.
        #
        # DEBUGGING - CHECK THE UPLOAD LOG - All these are recorded there.
        #====================================================
        primary_record = models.EasyUploaderPrimaryRecord.objects.get(pk=self.primary_record.id)
        self.assertEqual(primary_record.filecount, 7)
        self.assertEqual(primary_record.filecountsucceed, 2)
        self.assert_(primary_record.uploadfinish)
 
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload1')
        self.assert_(not records[0].processed)
        self.assertEqual(records[0].errorenum, 4)
                
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload2')
        self.assert_(not records[0].processed)
        self.assertEqual(records[0].errorenum, 5)
        
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload3')
        self.assert_(not records[0].processed)
        self.assertEqual(records[0].errorenum, 2)
        
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload4')
        self.assert_(not records[0].processed)
        self.assertEqual(records[0].errorenum, 2) # This should probably be a 3, but I am not going to sweat it.
                
#         all_races = SingleRaceDetails.objects.all()
#         for race in all_races:
#             print race
#         all_records = models.EasyUploadRecord.objects.all()
#         for record in all_records:
#             print record
                
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload5')
        self.assert_(records[0].processed)
        self.assertEqual(records[0].errorenum, None)
        
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload6')
        self.assert_(records[0].processed)
        self.assertEqual(records[0].errorenum, 6)
        
        records = models.EasyUploadRecord.objects.filter(uploadrecord=self.primary_record, filename='upload7')
        self.assert_(records[0].processed)
        self.assertEqual(records[0].errorenum, None)